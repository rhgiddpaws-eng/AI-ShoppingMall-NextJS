# 네이버 배달 연동 설명서 (유치원생도 가능!)

이 문서는 네이버 지도를 처음 써보는 친구들을 위해 아주 쉽게 설명한 가이드와, 실제 배달 서비스를 만들 때 꼭 필요한 기능들을 정리한 메모장이에요.

---

## 1. 유치원생도 따라 하는 네이버 지도 띄우기 (아주 쉬움 주의)

네이버 지도를 우리 웹사이트에 가져오려면 **"네이버 클라우드 플랫폼"**이라는 문방구에서 **"지도 이용권(Client ID)"**을 받아와야 해요. 천천히 따라 해봐요!

### 1단계: 문방구 가기 (회원가입/로그인)
1. [네이버 클라우드 플랫폼](https://www.ncloud.com/) 사이트에 들어가요.
2. 로그인을 해요. (네이버 아이디로도 할 수 있어요!)
3. 처음이면 **"결제 수단"**을 등록해야 해요. (걱정 마세요! 지도는 공짜로 많이 쓸 수 있어서 돈이 거의 안 나가요. 하지만 등록은 꼭 해야 해요.)

### 2단계: 지도 이용권 신청하기 (Application 등록)
1. **[콘솔(Console)]** 버튼을 눌러서 들어가요. (내 책상 같은 곳이에요.)
2. 메뉴에서 **Services** -> **AI·NAVER API** -> **Maps**를 찾아서 눌러요.
3. **[+ Application 등록]** 파란색 버튼을 꾹 눌러요.
4. **이름 쓰기**: `내-멋진-배달앱` 처럼 이름을 마음대로 지어주세요.
5. **메뉴 고르기**:
   - `Web Dynamic Map` (지도가 움직여요!) -> **체크!**
   - `Mobile Dynamic Map` (핸드폰에서도 움직여요!) -> **체크!**
   - `Geocoding` (주소를 좌표로 바꿔줘요! 배달 주소 찾을 때 필수!) -> **체크!**
6. **주소 적기 (Web 서비스 URL)**:
   - 개발할 때는 `http://localhost:3000` 라고 적고 **[추가]** 버튼을 눌러요.
   - 나중에 진짜 인터넷에 올리면 그 주소도 추가해야 해요.
7. 다 했으면 **[등록]** 버튼 클릭!

### 3단계: 비밀번호 챙기기 (Client ID 확인)
1. 방금 만든 `내-멋진-배달앱`이 목록에 보일 거예요.
2. **[인증 정보]** 버튼을 누르면 **Client ID** (영어랑 숫자가 섞인 비밀번호)가 보여요.
3. 이 **Client ID**를 복사해서 소중히 간직하세요! (절대 남에게 보여주면 안 돼요!)

### 4단계: 내 코드에 지도 그리기 (Next.js 예시)

이제 코딩할 차례예요. 터미널을 열고 다음 명령어로 필요한 도구를 설치해요.

```bash
npm install react-naver-maps
# 또는
pnpm add react-naver-maps
```

그리고 지도를 보여줄 파일을 만들어서 아래 코드를 붙여넣으세요. (`NEXT_PUBLIC_NCP_CLIENT_ID`는 아까 복사한 비밀번호를 `.env.local` 파일에 넣어서 써야 해요!)

**.env.local 파일 만들기:**
```text
NEXT_PUBLIC_NCP_CLIENT_ID=아까복사한_Client_ID_여기에_붙여넣기
```

**MapComponent.tsx (지도 컴포넌트):**
```tsx
'use client';

import { Container as MapDiv, NaverMap, useNavermaps, Overlay, Marker } from 'react-naver-maps';

function MyMap() {
  const navermaps = useNavermaps();

  return (
    // 지도를 담을 그릇 (크기를 꼭 정해줘야 해요!)
    <MapDiv style={{ width: '100%', height: '400px' }}>
      <NaverMap
        defaultCenter={new navermaps.LatLng(37.5666805, 126.9784147)} // 서울시청 좌표
        defaultZoom={15} // 얼마나 확대할지 (숫자가 클수록 가까이 보여요)
      >
        <Marker 
            position={new navermaps.LatLng(37.5666805, 126.9784147)}
            animation={2} // 마커 방방 뛰기
        />
      </NaverMap>
    </MapDiv>
  );
}

export default MyMap;
```

**_app.tsx 또는 layout.tsx (전체 설정):**
```tsx
import { NavermapsProvider } from 'react-naver-maps';

// ... 감싸주기
<NavermapsProvider ncpClientId={process.env.NEXT_PUBLIC_NCP_CLIENT_ID}>
  <Component {...pageProps} />
</NavermapsProvider>
```

짜잔! 이제 화면에 지도가 나올 거예요. 

---

## 2. 실제 배달을 위해 더 필요한 것들 (체크리스트)

지도가 보인다고 배달 앱이 끝난 게 아니에요! 실제 라이더가 움직이고 우리가 그걸 보려면 이게 필요해요.

### 📍 1. 실시간 위치 추적 (라이더는 어디에?)
- **필요한 것**: 라이더의 핸드폰 GPS 정보를 3초~5초마다 서버로 보내야 해요.
- **기술**: WebSocket(웹소켓)이나 Firebase Realtime Database 같은 걸 써서 지도 위 라이더 마커(오토바이 그림)를 계속 움직여줘야 해요.

### 🏠 2. 주소 변환 (지오코딩 & 역지오코딩)
- **상황**: 고객은 "서울시 강남구..."라고 주소를 쓰지만, 지도는 숫자(위도, 경도)만 알아들어요.
- **해결**: 네이버 클라우드 플랫폼에서 `Geocoding` API를 꼭 추가 신청해서, 글자 주소를 숫자 좌표로 바꿔줘야 마커를 찍을 수 있어요.

### 🛵 3. 배달 상태 관리 (지금 뭐 하고 있지?)
- 배달은 단계가 있어요.
  1. **주문 수락 (접수)**
  2. **조리 중 (픽업 대기)**
  3. **배달 시작 (라이더 이동 중)**
  4. **배달 완료**
- 이 상태가 바뀔 때마다 앱 화면도 바뀌고(예: "조리 중입니다"), 카카오톡 알림도 가야 해요.

### 🛣️ 4. 경로 보여주기 (길 찾기)
- 라이더가 가게에서 손님 집까지 가는 **최적의 길**을 선으로 그려줘야 해요.
- 네이버 `Driving` API를 쓰면 자동차/오토바이 길 찾기 경로 데이터를 받을 수 있어요. (지도 위에 파란 선 긋기)

### 👮 5. 안전과 보안
- 라이더의 위치는 개인정보예요! 배달이 끝나면 위치 추적을 바로 멈춰야 해요.
- 라이더 전화번호, 고객 전화번호는 안심번호(0505...)를 쓰는 게 좋아요. 

https://www.youtube.com/watch?v=nu_I3hxkyXU&utm_source=chatgpt.com
https://www.youtube.com/watch?v=JJZEK94G7nE&utm_source=chatgpt.com
https://www.youtube.com/watch?v=GzUu1Sjr-SE&utm_source=chatgpt.com
https://www.youtube.com/watch?v=lQXspbcdAVQ&utm_source=chatgpt.com
https://www.youtube.com/watch?v=NPAGRzdYXpQ&utm_source=chatgpt.com

좋습니다 👍
그럼 Next.js 14 (App Router) 기준 + 네이버 지도 + 실시간 배달 추적 구조로 바로 실행 가능한 기본 뼈대를 드릴게요.

🚀 목표

✔ 네이버 지도 표시
✔ 주문자 위치 표시
✔ 라이더 실시간 위치 업데이트
✔ API Route 사용
✔ Socket.io 기반 실시간 통신

1️⃣ 프로젝트 생성
npx create-next-app@latest delivery-app
cd delivery-app
npm install socket.io socket.io-client axios

2️⃣ 네이버 지도 SDK 추가
📌 app/layout.tsx
export const metadata = {
  title: "Delivery App",
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html>
      <head>
        <script
          src={`https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=${process.env.NEXT_PUBLIC_NAVER_KEY}`}
        ></script>
      </head>
      <body>{children}</body>
    </html>
  );
}

3️⃣ 지도 페이지
📌 app/page.tsx
"use client";

import { useEffect, useRef } from "react";
import io from "socket.io-client";

const socket = io("http://localhost:3001");

export default function Home() {
  const mapRef = useRef<HTMLDivElement>(null);
  const riderMarkerRef = useRef<any>(null);

  useEffect(() => {
    if (!mapRef.current) return;

    const map = new window.naver.maps.Map(mapRef.current, {
      center: new window.naver.maps.LatLng(37.5665, 126.9780),
      zoom: 14,
    });

    riderMarkerRef.current = new window.naver.maps.Marker({
      position: new window.naver.maps.LatLng(37.5665, 126.9780),
      map,
    });

    socket.on("updateLocation", (data) => {
      riderMarkerRef.current.setPosition(
        new window.naver.maps.LatLng(data.lat, data.lng)
      );
    });
  }, []);

  return <div ref={mapRef} style={{ width: "100%", height: "100vh" }} />;
}

4️⃣ 실시간 서버 (별도 Node 서버)

Next.js는 WebSocket 서버용으로는 제한이 있으니
별도 서버 하나 띄우는 게 안정적입니다.

📌 server.js
const { createServer } = require("http");
const { Server } = require("socket.io");

const httpServer = createServer();
const io = new Server(httpServer, {
  cors: { origin: "*" },
});

io.on("connection", (socket) => {
  console.log("connected");

  socket.on("riderLocation", (data) => {
    io.emit("updateLocation", data);
  });
});

httpServer.listen(3001, () => {
  console.log("Socket server running on 3001");
});


실행:

node server.js

5️⃣ 라이더 위치 전송 예시

테스트용 코드 (브라우저 콘솔에서 실행 가능)

navigator.geolocation.watchPosition((pos) => {
  socket.emit("riderLocation", {
    lat: pos.coords.latitude,
    lng: pos.coords.longitude,
  });
});

🔥 여기까지 하면 완성되는 것

✔ 네이버 지도 표시
✔ 라이더 마커 표시
✔ 실시간 위치 반영
✔ Next.js App Router 구조
✔ WebSocket 기반 배달 추적

🎯 추가 확장 가능

✅ 주소 → 좌표 변환 API Route 추가

✅ 배달 경로 Polyline 표시

✅ Supabase DB 연동

✅ Vercel 배포 + Render WebSocket 서버

원하면 다음 단계로:

1️⃣ 서버 없이 Next.js 내부 WebSocket 통합 버전
2️⃣ 실시간 경로 자동 갱신 버전
3️⃣ 가게/주문/결제까지 포함한 풀 구조

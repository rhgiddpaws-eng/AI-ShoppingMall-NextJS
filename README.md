# 1. 개요

본 프로젝트는 **Next.js** 기반의 쇼핑몰 MVP를 구축하는 것을 목표로 합니다. 
주요 레퍼런스 사이트로 **ASOS**를 참고하되, MVP 단계에서는 핵심 기능만 우선 구현합니다. 
특히 **LLM(Large Language Model) 기반 개발** 방식을 적용하여 
**AI가 주도적으로 개발 프로세스를 지원**하도록 설계합니다.

- **DB**는 **PostgreSQL**을 사용하며, **Prisma**를 통해 
스키마를 자동 생성하고 마이그레이션 과정을 간소화합니다.

- **pgvector**를 활용하여 상품 정보를 벡터 임베딩 후 유사도 검색을 수행함으로써, 
**임베딩 기반 상품 추천** 기능을 구현합니다.

- 결제 시스템으로는 **토스페이먼츠(Toss Payments)**를 연동하고, 
결제 보안을 위해 **웹훅(Webhook)**을 적용합니다.

- 반응형 UI, **다크모드 지원**, 그리고 **매끄럽고 인터랙티브한 사용자 경험**을 
제공하는 고수준의 UI/UX를 목표로 합니다.

### 개발 워크플로우 (도커 이슈 시)
- 변경사항 커밋 후 **push**하고, 도커 컨테이너는 중지한 뒤 **로컬에서 `pnpm dev`**로 개발·검증하는 것을 권장합니다.
- 도커 이슈 재현이 필요할 때만 `docker-compose`로 띄워 확인합니다. 진행 상황은 [DOCUMENT/tasks.md](DOCUMENT/tasks.md)에서 체크리스트로 관리합니다.

---

# 2. 주요 기능

## 2.1 홈페이지 및 네비게이션
1. **홈 화면**
   - 메인 배너(프로모션 이미지 등)와 대표 상품 목록 노출
   - 인기 상품/신상품 추천 섹션
2. **네비게이션 바**
   - 로고 및 사이트명, 카테고리별 이동 메뉴
   - 검색창(상품명, 카테고리 키워드 검색)
   - 로그인/회원가입/장바구니/마이페이지 바로가기
3. **카테고리별 필터**
   - 카테고리를 선택하면 해당 카테고리에 속한 상품 목록을 필터링
   - 사이즈, 색상, 가격대 등의 세부 필터링 고려 (MVP에서는 단순 카테고리 중심)
4. **검색 기능**
   - 상품명, 키워드 기반 검색
   - 검색 결과 페이지에서 카테고리, 가격 정렬 등의 추가 옵션 제공
5. **반응형 UI 및 다크모드 지원**
   - PC, 태블릿, 모바일 디바이스에 대응하는 레이아웃
   - 다크모드 스위치를 통해 사용자 테마 설정 가능

## 2.2 상품 상세 페이지
1. **기본 정보 표시**
   - 상품 이미지(슬라이드/갤러리), 가격, 상세 설명, 재고 상태
2. **추천 상품 목록**
   - pgvector를 활용하여 유사도 검색된 상품을 함께 노출
   - 상품 임베딩을 통해 연관성 높은 상품부터 순서대로 추천
3. **장바구니 담기 / 바로 구매**
   - 장바구니에 추가 버튼 (로그인 시 서버 반영, 비로그인 시 로컬 저장)
   - 바로 구매 시 주문 페이지로 이동

## 2.3 장바구니 및 주문 기능
1. **장바구니 및 위시리스트**
   - **로그인 사용자**: DB(서버)에서 관리. GET/POST/PATCH/DELETE `/api/user/cart`, `/api/user/wishlist` 로 조회·추가·수정·삭제. 클라이언트는 서버 응답으로 스토어(Zustand) 갱신 후 로컬 캐시로 사용.
   - **비로그인 사용자**: 브라우저 localStorage(persist)에서만 관리. 로그인 시 서버 장바구니/위시리스트로 전환됨.
   - 상품 추가/삭제/수량 변경, 장바구니 내 총 금액 표시.
2. **주문 페이지**
   - 프론트엔드 장바구니 데이터를 기반으로 주문을 생성
   - 배송 정보(수령인, 주소, 연락처) 입력
   - 상품별 가격, 배송비, 총 결제 금액 표시
   - **토스페이먼츠 결제** 연동
3. **결제 및 웹훅(Webhook)**
   - 토스페이먼츠 결제 처리 후 결제 성공/실패 상태 업데이트
   - 결제 정보(승인 번호, 금액 등) DB 저장
   - **웹훅**을 통해 결제/취소/환불 등의 상태를 안전하게 수신

## 2.4 사용자 관리
1. **회원가입 및 로그인**
   - 소셜 로그인(OAuth) 및 이메일 로그인 제공
   - 비밀번호 분실/재설정 기능
2. **프로필 관리**
   - 기본 프로필(닉네임, 프로필 이미지, 연락처 등) 수정
   - 주문 내역 조회, 반품/교환 신청(심화 기능은 MVP 이후 고려)

## 2.5 AI 상품 추천 시스템
1. **벡터 임베딩을 통한 상품 유사도 검색**
   - 상품명 또는 상품 특징을 OpenAI 등의 임베딩 API로 임베딩
   - pgvector를 통해 유사도 검색이 가능한 인덱스 관리
2. **추천 로직**
   - 상품 상세 페이지에서 비슷한 상품 제안
   - 홈/카테고리 페이지에서 인기 상품 + 연관 상품 노출

## 2.6 UI/UX 및 인터랙션
1. **프리미엄 웹 디자인 수준의 인터랙션**
   - 페이지 전환 시 애니메이션, 마우스 오버 시 동적 효과
   - 장바구니 담기/삭제 시 UI 피드백 (토스트 메시지, 모달 등)
2. **다크모드 및 사용자 친화적 디자인**
   - 사용자가 편의에 따라 테마를 변경할 수 있으며, 기본적으로 OS 테마와 동기화 가능
3. **접근성 고려**
   - 버튼 및 폰트 크기, 라벨링 등을 고려하여 모든 사용자에게 사용 편의 제공



## 2.7 관리자 페이지

### 1) 대시보드  
- **유저 현황**  
  - 총 가입자 수, 최근(오늘/이번주/이번달) 가입자 수  
  - 활성 사용자(최근 로그인 사용자) 수 및 사용자 증감 추이  
- **매출/수입 현황**  
  - 이번 달 총 매출액, 전월 대비 매출 증감률  
  - 일/주/월 단위의 매출 추이 그래프(간단한 막대 혹은 선 그래프)  
  - 평균 주문 금액(평균 객단가), 판매량 등  
- **주문 현황**  
  - 전체 주문 건수, 최근 주문 건수  
  - 주문 상태별(결제 대기, 배송 중, 배송 완료 등) 건수  
  - 환불/취소/교환 신청 현황(선택사항)  
- **판매 현황**  
  - 베스트셀러(가장 많이 팔린 상품)  
  - 재고가 부족한 상품 목록 알림  
- **요약 알림/공지** (선택사항)  
  - 최근 등록된 신규 주문, 재고 임박 알림, 문의/CS 티켓 수 등  

### 2) 유저 관리 페이지  
- **유저 리스트**  
  - 전체 사용자 목록 조회(이메일, 이름, 가입일 등)  
  - 검색/필터(기간별, 이름/이메일)  
- **유저 정보 상세**  
  - 로그인 정보(최근 로그인일 등)  
  - 주문 내역, 가입일, 권한(Role) 등  
- **유저 권한 설정** (선택사항)  
  - 일반 사용자 / 관리자 권한 부여  
  - 계정 활성/비활성화 처리  

### 3) 상품 관리 페이지  
- **상품 목록**  
  - 상품 검색(이름, 카테고리, 등록일 등), 필터링, 정렬  
  - 상품 재고/가격/상태(판매 중/품절) 표시  
- **상품 등록/수정**  
  - 상품명, 설명, 가격, 재고, 이미지 등록  
  - 판매 상태(진행/중지) 여부, 카테고리/태그 설정  
- **재고 관리**  
  - 재고가 적은 상품 자동 표시  
  - 재고 수량 일괄 수정(선택사항)  

### 4) 주문 관리 페이지  
- **주문 목록**  
  - 주문 번호, 사용자명, 주문 일자, 결제 상태, 배송 상태 표시  
  - 검색(주문 번호, 사용자명, 기간별), 필터링(결제 상태, 배송 상태)  
- **주문 상세**  
  - 주문 상품 목록, 결제 금액, 배송 정보(주소, 수령인, 연락처 등)  
  - 주문 상태 업데이트(‘배송 준비’, ‘배송 중’, ‘배송 완료’ 등)  
  - 환불/교환/취소 처리(필요 시)  


# 3. 데이터 모델

**Cart / CartItem / Wishlist / WishlistEntry** 는 로그인 사용자의 장바구니·위시리스트를 서버(DB)에서 관리할 때 사용합니다. 주문( Order, OrderItem ), 결제( Payment )와 함께 백엔드 DB로 관리합니다.

```
┌───────────────┐       ┌───────────────┐
│   User         │       │   Product     │
│───────────────│       │───────────────│
│ id (PK)       │       │ id (PK)       │
│ email         │       │ name          │
│ password      │       │ description   │
│ name          │       │ price         │
│ createdAt     │       │ stock         │
│ updatedAt     │       │ vector (pgvector) │
└───────────────┘       │ createdAt     │
                         │ updatedAt     │
                         └───────────────┘
                         
┌───────────────┐       ┌───────────────┐
│   Cart         │       │  CartItem      │
│───────────────│       │───────────────│
│ id (PK)       │       │ id (PK)       │
│ userId (FK)   │───┐   │ cartId (FK)   │
│ createdAt     │   │   │ productId (FK)│
│ updatedAt     │   └───│ quantity      │
└───────────────┘       │ createdAt     │
                        │ updatedAt     │
                        └───────────────┘

┌───────────────┐       ┌───────────────┐
│   Wishlist     │       │ WishlistEntry  │
│───────────────│       │───────────────│
│ id (PK)       │       │ id (PK)       │
│ userId (FK)   │───┐   │ wishlistId(FK)│
│ createdAt     │   └───│ productId (FK)│
│ updatedAt     │       │ createdAt     │
└───────────────┘       │ updatedAt     │
                        └───────────────┘

┌───────────────┐       ┌───────────────┐        ┌────────────────┐
│   Order        │       │  OrderItem    │        │   Payment       │
│───────────────│       │───────────────│        │────────────────│
│ id (PK)       │       │ id (PK)       │        │ id (PK)        │
│ userId (FK)   │       │ orderId (FK)  │        │ orderId (FK)   │
│ totalAmount   │       │ productId (FK)│        │ paymentMethod  │
│ status        │       │ quantity      │        │ amount         │
│ createdAt     │       │ price         │        │ status         │
│ updatedAt     │       │ createdAt     │        │ transactionId  │
└───────────────┘       │ updatedAt     │        │ createdAt      │
                         └───────────────┘        │ updatedAt      │
                                                  └────────────────┘
```

### 주요 테이블/컬럼 설명

1. **User**
   - `id`: Primary Key
   - `email`: 이메일 주소 (Unique)
   - `password`: 해시된 비밀번호 (소셜 로그인 시 null 가능)
   - `name`: 사용자 이름 / 닉네임
   - `createdAt`, `updatedAt`: 생성/수정 시간

2. **Product**
   - `id`: Primary Key
   - `name`, `description`: 상품 명, 상세 설명
   - `price`: 상품 가격
   - `stock`: 재고 수량
   - `vector`: 상품 임베딩 데이터(pgvector) 저장 컬럼
   - `createdAt`, `updatedAt`

3. **Cart / CartItem (로그인 사용자 장바구니, 서버 관리)**
   - `Cart`: `id`, `userId`(unique), `createdAt`, `updatedAt`. 사용자당 1개.
   - `CartItem`: `id`, `cartId`, `productId`, `quantity`, `createdAt`, `updatedAt`. (cartId, productId) unique.
   - `/api/user/cart` 에서 조회·추가·수량 변경·삭제.

4. **Wishlist / WishlistEntry (로그인 사용자 위시리스트, 서버 관리)**
   - `Wishlist`: `id`, `userId`(unique), `createdAt`, `updatedAt`. 사용자당 1개.
   - `WishlistEntry`: `id`, `wishlistId`, `productId`, `createdAt`, `updatedAt`. (wishlistId, productId) unique.
   - `/api/user/wishlist` 에서 조회·추가·삭제.

5. **Order**
   - `id`: Primary Key
   - `userId`: 주문을 진행한 사용자
   - `totalAmount`: 총 결제 금액
   - `status`: 주문 상태(예: `PENDING`, `PAID`, `CANCELED` 등)
   - `createdAt`, `updatedAt`

6. **OrderItem**
   - `id`: Primary Key
   - `orderId`: Order 테이블과 N:1 관계
   - `productId`: Product 테이블과 N:1 관계
   - `quantity`: 주문 시 구매한 상품 수량
   - `price`: 구매 당시 상품 가격(변동 가격 고려 시 보존)
   - `createdAt`, `updatedAt`

7. **Payment**
   - `id`: Primary Key
   - `orderId`: Order 테이블과 1:1 관계
   - `paymentMethod`: 결제 방식(토스페이먼츠, 카드, 가상계좌 등)
   - `amount`: 결제 금액
   - `status`: 결제 상태(예: `WAITING`, `PAID`, `FAILED`)
   - `transactionId`: 외부 결제사에서 부여하는 거래 ID
   - `createdAt`, `updatedAt`

---

# 4. 기술 스택

1. **프론트엔드**
   - **Next.js (React 기반)**
   - React Query / SWR 등의 데이터 패칭 라이브러리
   - Tailwind CSS / Styled Components / Emotion 등 스타일링 라이브러리
   - React Hook Form(폼 처리), Headless UI(모달/셀렉트 등) 활용 가능
   - 다크모드 지원(Next-themes 등 라이브러리 고려)
   - **장바구니/위시리스트**: 로그인 시 서버(DB) 연동, 비로그인 시 Local Storage(Zustand persist)로 관리

2. **백엔드**
   - **Node.js** + **Next.js API Routes** (필요 시 서버리스 아키텍처로 확장)
   - **PostgreSQL** + **Prisma** (ORM)
   - AI 연동: **OpenAI 임베딩 API**(상품명/설명 임베딩 후 pgvector 저장)
   - **pgvector** 확장 기능 (PostgreSQL에서 유사도 검색)
   - 결제: **토스페이먼츠** API + **웹훅(Webhook)**

3. **인프라 및 DevOps**
   - Vercel 또는 AWS(EC2, RDS 등) 배포 고려
   - GitHub Actions 등을 통한 CI/CD 자동화
   - 보안: HTTPS 적용, OAuth 인증 시 JWT 사용 고려


4. **기타**
   - 애널리틱스: Google Analytics, Amplitude 등 추후 연동 가능
   - 이메일/알림: SendGrid, Nodemailer 등 추후 연동 가능

---

# 5. MVP 범위

## 5.1 반드시 포함할 기능
1. **홈페이지 및 네비게이션**: 카테고리/검색 기능, 다크모드, 반응형 UI
2. **상품 상세 페이지**: 이미지, 가격, 설명, 재고 상태, **프론트엔드 장바구니 담기**, **pgvector 기반 추천**
3. **장바구니 및 주문**: 
   - **장바구니/위시리스트**: 로그인 사용자는 서버(DB) CRUD, 비로그인은 로컬(persist) CRUD
   - 주문 작성, 배송 정보 입력
4. **결제 시스템**: **토스페이먼츠** 연동, 결제 성공/실패 여부 처리, **웹훅** 기반 상태 업데이트
5. **사용자 인증**: 이메일/비밀번호 로그인, 기본 프로필 관리
6. **AI 추천 시스템**: 상품 벡터 임베딩 및 유사도 추천(기본 로직)



## 5.2 제외(또는 MVP 이후 고려) 기능
1. **리뷰/평점 시스템**  
   - 상품 후기, 평점 관리 등은 2차 버전 이후 도입
2. **다양한 필터링 및 정렬 옵션**  
   - 사이즈, 색상, 가격대별 정렬 등은 MVP 이후 단계적으로 추가
3. **쿠폰 및 할인 코드**  
   - 할인 정책, 프로모션은 MVP 출시 후 업데이트
4. **고급 마이페이지 기능**  
   - 반품/교환 접수, 배송 추적, 적립금 관리 등은 추후 고려
5. **멀티 언어 지원**  
   - 국제화(i18n) 지원은 해외 진출 시점에 추가


## 5.3 MVP 범위에서의 관리자 페이지 고려사항

- **필수 기능**  
  - **대시보드**: 유저 수, 이번 달 매출, 기본적인 주문 현황만 간략하게라도 확인 가능하도록 구축  
  - **유저 관리**: 사용자 목록(검색), 가입일/최근 로그인 정도 확인  
  - **상품 관리**: 상품 CRUD, 재고 상태 파악  
  - **주문 관리**: 주문 목록 및 주문 상태(결제 대기, 결제 완료, 배송 중, 완료 등) 조회  



- **확장 기능** (이후 버전에서 고려)  
  - **고급 분석**: 날짜/상품별 매출 추이, 전환율, 환불률, 방문 트래픽 분석 등  
  - **다양한 필터/정렬**: 여러 조건 조합으로 주문/유저/상품 등을 세밀하게 필터링  
  - **권한 관리**: 관리자/CS 직원 등 역할별로 접근 권한을 세분화  



## 6.1 기타 중요사항
- **DB 초기화**
- S3 버킷 초기화
- npx tsx scripts/cleanup_all_except_user.ts
- npx tsx scripts/upload_many_products.ts
- npx tsx scripts/generate_mock_orders.ts


- **벡터값 넣기**
  - prisma client 가 제공하는 로우쿼리를 이용해야 백터값을 db에 업데이트 할수 있음
- **포트포워딩**
  - 내 원룸 공인 IP 는 112.214.35.103 임
  - 공유기에서  http://192.168.200.254:10010 원룸
  - admin, admin015C (015C 는 뒷면 맥주소 마지막 4개)

  - 규칙 이름	아무 이름 (예: nginx 또는 웹80)
  - 내부 IP 주소(서버 PC)	192.168.200.121 (nginx 돌리는 이 PC의 IP)
  - 프로토콜	TCP (또는 ALL)
  - 포트번호(외부)	왼쪽 칸 80, 오른쪽 칸 80
  - 포트번호(내부)	왼쪽 칸 80, 오른쪽 칸 80

  - 서로 다른 호스트 이름이라 ncott.shop만 바꿔도 됩니다.
  -  ncott.shop → A 레코드만 당신 공인 IP로 수정 (또는 기존 CNAME 제거 후 A 추가)
  - cdn.ncott.shop → 지금처럼 AWS(S3/CloudFront 등)로 두기
  - 그러면:
  - https://ncott.shop → 당신 서버(nginx)
  -  https://cdn.ncott.shop (또는 프로젝트에서 쓰는 CDN URL) → S3/CDN 그대로 동작
   
  
  지금 ncott.shop이 AWS 쪽으로 가게 하려고 CNAME으로 되어 있을 수 있어요.
예: ncott.shop → CNAME → d1234abcd.cloudfront.net (CloudFront)
이렇게 되어 있으면, 누가 ncott.shop으로 접속하면 DNS가 “실제로는 저 CloudFront 주소로 가라”고만 알려주고, 최종적으로는 AWS(CloudFront) IP로 연결됩니다.
그래서:
CNAME 제거 = ncott.shop이 더 이상 “다른 도메인(CloudFront 등)”을 가리키지 않게 지우는 것.
A 추가 = ncott.shop을 “이 IP(공유기 공인 IP)로 가라”고 새로 적어 넣는 것.
한 마디로:
CNAME: “ncott.shop = 저 도메인(AWS 주소)랑 같아”
A: “ncott.shop = 이 IP(공유기 공인 IP)로 가”
그래서 ncott.shop을 공유기로 보내려면
“CNAME 있으면 그거 빼고, 대신 A 레코드로 공인 IP 넣어라”는 뜻으로 말한 거예요.
cdn.ncott.shop은 CNAME 그대로 두고, ncott.shop만 CNAME 제거 후 A로 바꾸면 됩니다.